#!/usr/bin/env -S awk -f
function caj(merry, christmas, folks) { h = christmas > 1; j = merry < NR; k = merry > 1; l = christmas < NF; folks += (k && occ[merry - 1, christmas]); folks += (k && l && occ[merry - 1, christmas + 1]); folks += (l && occ[merry, christmas + 1]); folks += (j && l && occ[merry + 1, christmas + 1]); folks += (j && occ[merry + 1, christmas]); folks += (j && h && occ[merry + 1, christmas - 1]); folks += (h && occ[merry, christmas - 1]); folks += (k && h && occ[merry - 1, christmas - 1]); return folks; }
BEGIN { FS = "" } { for (christmas = 1; christmas <= NF; christmas++) { occ[NR, christmas] = $christmas == "L";  floor[NR, christmas] = $christmas == "."; } } 
END { while (1) { t = 0; c = 0; for (merry = 1; merry <= NR; merry++) for (christmas = 1; christmas <= NF; christmas++) { if (floor[merry,christmas]) continue; copy[merry, christmas] = occ[merry, christmas]; aj = caj(merry, christmas); if (occ[merry, christmas] && aj > 3) copy[merry, christmas] = 0; else if (!occ[merry, christmas] && !aj) copy[merry, christmas] = 1; } for (merry = 1; merry <= NR; merry++) for (christmas = 1; christmas <= NF; christmas++) { if (occ[merry,christmas] != copy[merry,christmas]) c=1; occ[merry,christmas] = copy[merry,christmas]; if (occ[merry,christmas]) t++; } if (!c) { print "ðŸŽ„" t; exit 1; } } }
